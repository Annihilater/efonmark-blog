02-Tech-android
===============
创建日期 星期日 30 十二月 2018



android
=======

*****

### 手动安装并命令启动

pm install -r $full_path

ls -l /data/app

dumpsys package com.dongli.camera

am start -n com.dongli.camera.dressing/com.ucamera.ucam.CameraActivity 

### selinux：

uboot 关selinux：setenv EnableSelinux permissive;saveenv;reset
查看selinux相关信息日志：logcat -b events 

*****

**NDK环境安装：**
 一. 环境
1.GNU/Linux Ubuntu12.04操作系统(x86)
二. 下载NDK安装包
下载NDK，根据NDK里docs文档里的standalone-toolchain.html来抽取交叉编译的环境。
三. 制作交叉编译工具链
配置环境变量末尾添加如下三行
vi /etc/profile
export NDK=/opt/cross_tool/android-ndk-r16b
export NDK_CROSS=/opt/cross_tool/AndroidToolChain/bin
PATH=$PATH:$NDK:$NDK_CROSS
 保存后重启环境
source /etc/profile
执行命令：$NDK/build/tools/make-standalone-toolchain.sh --platform=android-19 --arch=arm --install-dir=/opt/cross_tool/AndroidToolChain/
其中$NDK环境变量是NDK的安装路径，选项--platform指定Android版本的开发形式,对应版本4.4.2 API。--arch指定目标执行的架构。--install-dir指定这个新生成的文件夹即是你的交叉编译环境，和其他交叉编译工具链使用方法类似。

*****

**卸载app：**
pm  uninstall com.xgimi.windowsystem

*****

**usb otg更改：**

![1564043151167](/home/soy/00_efonfighting/github-efonmark-blog/efonmark-blog/03-计算机基础知识/assert/1564043151167.png)

*****


Kernel
======

*****

**uboot下查看板子dts：**
fdt addr 0x1000000
fdt print

*****

**挂载分区：**
mount -t vfat /dev/block/sda1  /mnt/usb
mount -o rw,remount /tvservice

*****


xgimi定制
=======

*****

848编译：
./device/xgimi/build/makeAll.sh -o all -p MS -j 8 2>&1 | tee android.log

*****

打开极米电台
am start -n com.xgimi.doubanfm/.activity.MusicActivity

*****

机器序列号：gimi_pid   12位16进制

*****


amlogic
=======

## uboot播放U盘图片

usb start;
fatload usb 0 12000000 upgrade_upgrading.bmp
bmp display 0x12000000 

bootlogo制作
----------

su
mount -o rw,remount /dev/root 
cp /mnt/media_rw/30B8-6B86/bootanimation.zip [/system/media/bootanimation.zip](file:///system/media/bootanimation.zip)
sync

![1564043273643](/home/soy/00_efonfighting/github-efonmark-blog/efonmark-blog/03-计算机基础知识/assert/1564043273643.png)

zip ../bootanimation.zip * -0 -r

环境变量恢复默认值
---------
env default -a; save; reset

*****


视频信号转vbyone输出
-------------
setenv model_name UHD_1RG(或者UHD_2RG）

user版本调试功能
----------

在3/30日以后的版本生效，方法如下：

1.root权限获取
a.解压[附件](file:///home/soy/Notebooks/Notes/01-xgimi/02-Tech-android/xgimisu_aml.rar)中的文件到压缩包中，重启机器进入uboot  
b.设置环境变量  ：setenv XgimiDebug openwithpermissive ; save ; reset;
c.重启后再次进入uboot
d.进入recovery：  run recovery_from_flash
e.在recovery中执行：busybox --install /sbin;mkdir /udisk;mount /dev/block/sda1 /udisk;./udisk/xgimisu/install.sh
f.重启进入uboot，再次设置环境变量：setenv XgimiDebug openwithpermissive ; save ; reset;

2.打开串口调试
   a.进入uboot设置环境变量 ：setenv XgimiDebug openwithpermissive ; save ; reset;

*****


uboot加密编译
---------

1. ./device/xgimi/build/makeAll.sh -o uboot -p POKEMON -j40
2. ./device/xgimi/common/build/secureboot_remote_sign.sh bootloader.img  device/xgimi/xgimiapollo/bootloader.img
3. android\device\xgimi\pineapple\里面的
4. usb_update bootloader bootloader.img.encrypt.1

*****


关selinux
--------
setenv EnableSelinux permissive;save;res
getenforce

*****


跳过开机向导
------
pm disable com.google.android.tungsten.setupwraith

*****


分区挂载
----
mount -o remount,rw -t ext4 [/dev/root](file:///dev/root) /
mount -w -o remount [/dev/block/xgimiconfig](file:///dev/block/xgimiconfig) /xgimicofnig

*****


编译脚本
----
./device/xgimi/build/makeAll.sh -p POKEMON -o all -j 4 -v 1.0.1
uboot： ./mk tl1_x301_v1 --systemroot
公办uboot：./mk txlx_t962x_r311_v1 --systemroot 

签名uboot：
 ./device/xgimi/build/makeAll.sh -o uboot -p POKEMON -j8
./device/xgimi/common/build/secureboot_remote_sign.sh bootloader.img device/xgimi/xgimiapollo/bootloader.img
android\device\xgimi\pineapple\bootloader.img.encrypt.9


make dtbimage

编译方式(Android TV)：
1.OTA整包
source build/envsetup.sh
export BOARD_COMPILE_ATV=true
lunch marconi-userdebug
make otapackage
env default -a ; save 

*****


单个镜像刷机
------
usb_update bootloader bootloader.img.encrypt
usb_update _aml_dtb dt.img.encrypt
usb_update system system.img
usb_update boot boot.img.encrypt

*****


单刷gmpf_main
-----------

1. 单独编译libxgimi.a

./device/xgimi/build/makeAll.sh -o gmpf -p POKEMON -v 1.0.1 -j 20

2. 编译 gmpf_main.

. build/envsetup.sh
lunch pineapple-userdebug
cd vendor/xgimi/GMPF-SRC/xgimi/services/
mm

3. 刷gmpf_main

将out/target/product/pineapple/vendor/bin/gmpf_main拷贝到板子上/vendor/bin


4. 修改权限与selinux：

chgrp shell [/vendor/bin/gmpf_main](file:///vendor/bin/gmpf_main)
chmod 755 /vendor/bin/gmpf_main
restorecon /vendor/bin/gmpf_main

su
echo 0 > [/proc/sys/kernel/printk](file:///proc/sys/kernel/printk)
mount -o rw,remount /vendor
cp /mnt/media_rw/30B8-6B86/gmpf_main [/vendor/bin/gmpf_main](file:///vendor/bin/gmpf_main) -f
chgrp shell [/vendor/bin/gmpf_main](file:///vendor/bin/gmpf_main)
chmod 755 /vendor/bin/gmpf_main
restorecon /vendor/bin/gmpf_main

*****



mstar
=====

*****

export LC_ALL=C 

*****


848编译
-----
export PATH=$PATH:/opt/arm-2012.09/bin;export PATH=$PATH:/opt/arm-2011.03/bin 
./device/xgimi/build/makeAll.sh -o all -p MS     默认 -j8 编译
单独编译：./device/xgimi/build/makeAll.sh -o android -p MS -j8 

*****


848开日志
------
gmsu
 setprop ctl.start logd
 setprop ctl.start logd-reinit 
 logcat -G 150M
logcat | grep   FOCUS

*****


848user版本debug方法
----------------
优盘根目录放入[xgimisu文件夹](file:///home/soy/Notebooks/Notes/01-xgimi/02-Tech-android/xgimisu_mst.zip),插到机器上，
终端敲入命令reboot recovery会进入recovery界面，
再敲入busybox --install /sbin;mkdir /udisk;mount /dev/block/sda1 /udisk;./udisk/xgimisu/install.sh，

*****


coredump解析
----------
gunzip coredump.xxx.tar.gz (解压)
arm-none-linux-gnueabi-gdb symbols/applications/bin/tvos (或者MiSysSrv)
set solib-absolute-prefix symbols (设置symbols路径的前缀)
core-file core_dump.xxx  (设置需要解析的coredump文件)

*****